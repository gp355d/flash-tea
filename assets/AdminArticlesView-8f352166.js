import{m as P,D}from"./DelModal-520c51c9.js";import{b as $}from"./@ckeditor-b092e1d3.js";import{aM as u,aC as n,W as r,X as t,a3 as a,bj as U,ar as w,bl as x,bc as y,F as C,aK as M,U as B,b8 as E,aZ as A}from"./@vue-a2e6aab2.js";import{_ as k}from"./index-8f9b4ce5.js";import{P as N}from"./PaginationView-54b25221.js";import{S as _}from"./sweetalert2-fc38d252.js";import"./bootstrap-d9a0ff4a.js";import"./@popperjs-9847b28c.js";import"./vue-71628d3f.js";import"./pinia-7d28dea6.js";import"./vue-demi-71ba0ef2.js";import"./aos-aa3ba816.js";import"./lodash.throttle-ab0b6905.js";import"./lodash.debounce-ca1b1d09.js";import"./vue-router-49be82a2.js";import"./axios-08622986.js";import"./vue-axios-58a7c26f.js";import"./vue-loading-overlay-67898897.js";import"./vee-validate-aa725db8.js";import"./@vee-validate-55db0f47.js";const T={props:{article:{type:Object,default(){return{}}},isNew:{type:Boolean,default:!0}},data(){return{status:{},modal:"",tempArticle:{tag:[""],content:""},create_at:0,editor:$,editorConfig:{toolbar:["heading","|","bold","italic","link"]}}},mixins:[P],watch:{article(){this.tempArticle={...this.article,tag:this.article.tag||[],isPublic:this.article.isPublic||!1},[this.create_at]=new Date(this.tempArticle.create_at*1e3).toISOString().split("T")},create_at(){this.tempArticle.create_at=Math.floor(new Date(this.create_at)/1e3)}},methods:{}},L={class:"modal fade",id:"articleModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},S={class:"modal-dialog modal-xl",role:"document"},I={class:"modal-content border-0"},O={class:"modal-header bg-dark text-white"},R={class:"modal-title",id:"exampleModalLabel"},q={key:0},j={key:1},F=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),H={class:"modal-body"},z={class:"row"},K={class:"col-sm-4"},W={class:"mb-3"},X=t("label",{for:"title",class:"form-label"},"標題",-1),Z={class:"mb-3"},G=t("label",{for:"image",class:"form-label"},"輸入圖片網址",-1),J={class:"mb-3"},Q=t("label",{for:"author",class:"form-label"},"作者",-1),Y={class:"mb-3"},tt=t("label",{for:"create_at"},"文章建立日期",-1),et={class:"col-sm-8"},ot=t("label",{for:"tag",class:"form-label"},"標籤",-1),st={class:"row gx-1 mb-3"},lt={class:"input-group input-group-sm"},it=["onClick"],at=t("i",{class:"bi bi-x"},null,-1),nt=[at],rt={key:0,class:"col-md-2 mb-1"},ct={class:"mb-3"},dt=t("label",{for:"description",class:"form-label"},"文章描述",-1),mt={class:"mb-3"},pt={class:"mb-3"},ut={class:"form-check"},ht=t("label",{class:"form-check-label",for:"isPublic"}," 是否公開 ",-1),_t={class:"modal-footer"},bt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ft(s,e,l,m,o,p){const h=u("v-field"),b=u("error-message"),v=u("v-form"),c=u("ckeditor");return n(),r("div",L,[t("div",S,[t("div",I,[t("div",O,[t("h5",R,[l.isNew?(n(),r("span",q,"新增貼文")):(n(),r("span",j,"編輯貼文"))]),F]),t("div",H,[t("div",z,[t("div",K,[a(v,null,{default:U(({errors:d})=>[t("div",W,[X,a(h,{type:"text",name:"標題",class:w(["form-control",{"is-invalid":d.標題}]),id:"title",modelValue:o.tempArticle.title,"onUpdate:modelValue":e[0]||(e[0]=i=>o.tempArticle.title=i),placeholder:"請輸入標題",rules:"required"},null,8,["modelValue","class"]),a(b,{name:"標題",class:"invalid-feedback"})]),t("div",Z,[G,a(h,{type:"text",name:"圖片網址",class:w(["form-control",{"is-invalid":d.圖片網址}]),id:"image",modelValue:o.tempArticle.imgurl,"onUpdate:modelValue":e[1]||(e[1]=i=>o.tempArticle.imgurl=i),placeholder:"請輸入圖片連結",rules:"required"},null,8,["modelValue","class"]),a(b,{name:"圖片網址",class:"invalid-feedback"})]),t("div",J,[Q,a(h,{type:"text",name:"作者",class:w(["form-control",{"is-invalid":d.作者}]),id:"author",modelValue:o.tempArticle.author,"onUpdate:modelValue":e[2]||(e[2]=i=>o.tempArticle.author=i),placeholder:"請輸入標題",rules:"required"},null,8,["modelValue","class"]),a(b,{name:"作者",class:"invalid-feedback"})]),t("div",Y,[tt,x(t("input",{type:"date",name:"文章建立日期",class:"form-control",id:"create_at","onUpdate:modelValue":e[3]||(e[3]=i=>o.create_at=i)},null,512),[[y,o.create_at]])])]),_:1})]),t("div",et,[ot,t("div",st,[(n(!0),r(C,null,M(o.tempArticle.tag,(d,i)=>(n(),r("div",{class:"col-md-2 mb-1",key:i},[t("div",lt,[a(h,{type:"text",name:"標籤",class:"form-control form-control",id:"tag",modelValue:o.tempArticle.tag[i],"onUpdate:modelValue":V=>o.tempArticle.tag[i]=V,placeholder:"請輸入標籤"},null,8,["modelValue","onUpdate:modelValue"]),t("button",{type:"button",class:"btn btn-outline-danger",onClick:()=>o.tempArticle.tag.splice(i,1)},nt,8,it)])]))),128)),o.tempArticle.tag[o.tempArticle.tag.length-1]||!o.tempArticle.tag.length?(n(),r("div",rt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",type:"button",onClick:e[4]||(e[4]=()=>o.tempArticle.tag.push(""))}," 新增標籤 ")])):B("",!0)]),t("div",ct,[dt,x(t("textarea",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":e[5]||(e[5]=d=>o.tempArticle.description=d),placeholder:"請輸入文章描述"},null,512),[[y,o.tempArticle.description]])]),t("div",mt,[a(c,{editor:o.editor,modelValue:o.tempArticle.content,"onUpdate:modelValue":e[6]||(e[6]=d=>o.tempArticle.content=d),config:o.editorConfig},null,8,["editor","modelValue","config"])]),t("div",pt,[t("div",ut,[x(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=d=>o.tempArticle.isPublic=d),id:"isPublic"},null,512),[[E,o.tempArticle.isPublic]]),ht])])])])]),t("div",_t,[bt,t("button",{type:"button",class:"btn btn-primary",onClick:e[8]||(e[8]=()=>s.$emit("update-article",o.tempArticle))}," 確認 ")])])])],512)}const gt=k(T,[["render",ft]]),{VITE_APP_URL:f,VITE_APP_PATH:g}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"leo533",BASE_URL:"/flash-tea/",MODE:"production",DEV:!1,PROD:!0},At={data(){return{articles:[],tempArticle:{},isNew:!1,pagination:{}}},methods:{getArticles(s=1){const e=this.$loading.show();this.$http.get(`${f}v2/api/${g}/admin/articles/?page=${s}`).then(l=>{this.articles=l.data.articles,this.pagination=l.data.pagination,e.hide()}).catch(l=>{_.fire({position:"top-end",icon:"error",title:l.response.data.message,showConfirmButton:!1,timer:1500}),e.hide()})},getArticle(s){const e=this.$loading.show(),l=`${f}v2/api/${g}/admin/article/${s}`;this.$http.get(l).then(m=>{m.data.success&&(this.openModal(!1,m.data.article),this.isNew=!1,e.hide())}).catch(m=>{_.fire({position:"top-end",icon:"error",title:m.response.data.message,showConfirmButton:!1,timer:1500}),e.hide()})},openModal(s,e){s?(this.tempArticle={isPublic:!1,create_at:new Date().getTime()/1e3,tag:[]},this.isNew=!0):(this.tempArticle={...e},this.isNew=!1),this.$refs.articleModal.openModal()},updateArticle(s){this.tempArticle=s;let e=`${f}v2/api/${g}/admin/article`,l="post";this.isNew||(e=`${f}v2/api/${g}/admin/article/${this.tempArticle.id}`,l="put");const m=this.$refs.articleModal;this.$http[l](e,{data:this.tempArticle}).then(o=>{_.fire({position:"top-end",icon:"success",title:o.data.message,showConfirmButton:!1,timer:1500}),m.hideModal(),this.getArticles()}).catch(o=>{_.fire({position:"top-end",icon:"error",title:o.response.data.message,showConfirmButton:!1,timer:1500})})},openDelArticleModal(s){this.tempArticle={...s},this.$refs.articledelModal.openModal()},delArticle(){const s=`${f}v2/api/${g}/admin/article/${this.tempArticle.id}`;this.$http.delete(s).then(e=>{_.fire({position:"top-end",icon:"success",title:e.data.message,showConfirmButton:!1,timer:1500}),this.$refs.articledelModal.hideModal(),this.getArticles()}).catch(e=>{_.fire({position:"top-end",icon:"error",title:e.response.data.message,showConfirmButton:!1,timer:1500})})}},components:{ArticlesModal:gt,DelModal:D,Pagination:N},mounted(){this.getArticles(),document.title=this.$route.meta.title}},vt={class:"col-md-9 ms-sm-auto col-lg-10 px-md-4"},wt=t("h1",{class:"text-center text-primary fw-bold my-2"},"文章管理",-1),xt={class:"py-0"},yt={class:"text-end mt-4"},Ct={class:"table-responsive"},Mt={class:"table mt-4"},kt=t("thead",null,[t("tr",null,[t("th",{class:"text-nowrap"},"標題"),t("th",null,"作者"),t("th",null,"描述"),t("th",null,"建立時間"),t("th",{class:"text-nowrap"},"上架狀態"),t("th",{class:"text-nowrap"},"操作行為")])],-1),Vt={class:"text-nowrap"},Pt={class:"text-nowrap"},Dt={class:"text-truncate d-inline-block",style:{width:"100px"}},$t={class:"text-nowrap"},Ut={key:0},Bt={key:1},Et={class:"text-nowrap"},Nt={class:"btn-group"},Tt=["onClick"],Lt=["onClick"];function St(s,e,l,m,o,p){const h=u("ArticlesModal"),b=u("DelModal"),v=u("Pagination");return n(),r("main",vt,[wt,t("div",xt,[t("div",yt,[t("button",{class:"btn btn-primary",type:"button",onClick:e[0]||(e[0]=()=>p.openModal(!0))}," 建立新的文章 ")]),t("div",Ct,[t("table",Mt,[kt,t("tbody",null,[(n(!0),r(C,null,M(o.articles,c=>(n(),r("tr",{key:c.id},[t("td",Vt,A(c.title),1),t("td",Pt,A(c.author),1),t("td",null,[t("span",Dt,A(c.description),1)]),t("td",$t,A(s.$filters.date(c.create_at)),1),t("td",null,[c.isPublic?(n(),r("span",Ut,"已上架")):(n(),r("span",Bt,"未上架"))]),t("td",Et,[t("div",Nt,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:()=>p.getArticle(c.id)}," 編輯 ",8,Tt),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:()=>p.openDelArticleModal(c)}," 刪除 ",8,Lt)])])]))),128))])])]),a(h,{ref:"articleModal",article:o.tempArticle,"is-new":o.isNew,onUpdateArticle:p.updateArticle},null,8,["article","is-new","onUpdateArticle"]),a(b,{ref:"articledelModal","temp-items":o.tempArticle,onDeleteData:p.delArticle,id:4},null,8,["temp-items","onDeleteData"]),a(v,{pages:o.pagination,onEmitPages:p.getArticles},null,8,["pages","onEmitPages"])])])}const le=k(At,[["render",St]]);export{le as default};
